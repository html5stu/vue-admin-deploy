import{L as y,g as Z,h as b,l as N,m as ee,r as s,z as le,a as I,o as c,b as k,e as t,w as a,n as O,f as r,A as te,s as v,t as $,v as ae,M as oe,N as ne,E as h,F as se}from"./index-B9wvQeQm.js";import{g as ue}from"./role-v-pRJHd9.js";function re(d){return y({url:"/user/list",method:"get",params:d})}function de(d){return y({url:"/user",method:"post",data:d})}function ie(d){return y({url:"/user",method:"put",data:d})}function pe(d){return y({url:`/user/${d}`,method:"delete"})}function me(d){return y({url:"/user/status",method:"post",data:d})}const ge={class:"p-6"},fe={class:"bg-white p-4 rounded-lg shadow-sm mb-4"},ce={class:"mb-0"},_e={class:"bg-white p-4 rounded-lg shadow-sm"},be={class:"mt-4 flex justify-end"},Ve=Z({__name:"user",setup(d){const C=b(!1),S=b(0),x=b([]),z=b([]),U=b(),u=N({pageNum:1,pageSize:10,username:"",phone:"",status:void 0}),p=N({visible:!1,title:""}),o=N({id:void 0,username:"",password:"",nickname:"",roleId:void 0,phone:"",status:1,remark:""}),q={username:[{required:!0,message:"必填",trigger:"blur"}],password:[{required:!0,message:"必填",trigger:"blur"},{min:6,message:"至少6位",trigger:"blur"}],nickname:[{required:!0,message:"必填",trigger:"blur"}]},B=n=>n?new Date(n).toLocaleString():"",V=async()=>{C.value=!0;try{const n=await re(u);x.value=n.data.list,S.value=n.data.total}finally{C.value=!1}},F=async()=>{const n=await ue({pageNum:1,pageSize:100,status:1});z.value=n.data.list},_=()=>{u.pageNum=1,V()},R=()=>{u.username="",u.phone="",_()},j=()=>{p.title="新增用户",p.visible=!0,Object.assign(o,{id:void 0,username:"",password:"",nickname:"",roleId:void 0,phone:"",status:1,remark:""}),setTimeout(()=>U.value?.clearValidate(),0)},M=n=>{p.title="编辑用户",p.visible=!0,Object.assign(o,JSON.parse(JSON.stringify(n))),o.password=""},K=async()=>{await U.value.validate(async n=>{n&&(o.id?(await ie(o),h.success("修改成功")):(await de(o),h.success("新增成功")),p.visible=!1,V())})},P=n=>{se.confirm(`确认删除用户 "${n.username}"?`,"警告",{type:"warning"}).then(async()=>{await pe(n.id),h.success("删除成功"),V()})},T=async n=>{try{await me({id:n.id,status:n.status}),h.success("状态更新成功")}catch{n.status=n.status===1?0:1}};return ee(()=>{V(),F()}),(n,e)=>{const g=s("el-input"),i=s("el-form-item"),f=s("el-button"),D=s("el-form"),m=s("el-table-column"),L=s("el-tag"),A=s("el-switch"),J=s("el-table"),Q=s("el-pagination"),G=s("el-option"),H=s("el-select"),E=s("el-radio"),W=s("el-radio-group"),X=s("el-dialog"),Y=le("loading");return c(),I("div",ge,[k("div",fe,[t(D,{inline:!0,model:u},{default:a(()=>[t(i,{label:"用户账号"},{default:a(()=>[t(g,{modelValue:u.username,"onUpdate:modelValue":e[0]||(e[0]=l=>u.username=l),placeholder:"请输入账号",clearable:"",onKeyup:O(_,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"手机号码"},{default:a(()=>[t(g,{modelValue:u.phone,"onUpdate:modelValue":e[1]||(e[1]=l=>u.phone=l),placeholder:"请输入手机号",clearable:"",onKeyup:O(_,["enter"])},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(f,{type:"primary",icon:"Search",onClick:_},{default:a(()=>[...e[13]||(e[13]=[r("搜索",-1)])]),_:1}),t(f,{icon:"Refresh",onClick:R},{default:a(()=>[...e[14]||(e[14]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),k("div",ce,[t(f,{type:"primary",plain:"",icon:"Plus",onClick:j},{default:a(()=>[...e[15]||(e[15]=[r("新增用户",-1)])]),_:1})])]),k("div",_e,[te((c(),v(J,{data:x.value,border:"",style:{width:"100%"}},{default:a(()=>[t(m,{prop:"id",label:"ID",width:"80",align:"center"}),t(m,{prop:"username",label:"用户账号","min-width":"120"}),t(m,{prop:"nickname",label:"昵称","min-width":"120"}),t(m,{prop:"roleName",label:"角色","min-width":"120"},{default:a(({row:l})=>[l.roleName?(c(),v(L,{key:0,type:"success"},{default:a(()=>[r($(l.roleName),1)]),_:2},1024)):(c(),v(L,{key:1,type:"info"},{default:a(()=>[...e[16]||(e[16]=[r("暂无角色",-1)])]),_:1}))]),_:1}),t(m,{prop:"phone",label:"手机号码",width:"120"}),t(m,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(A,{modelValue:l.status,"onUpdate:modelValue":w=>l.status=w,"active-value":1,"inactive-value":0,onChange:w=>T(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(m,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[r($(B(l.created_at)),1)]),_:1}),t(m,{label:"操作",width:"180",align:"center",fixed:"right"},{default:a(({row:l})=>[t(f,{link:"",type:"primary",icon:"Edit",onClick:w=>M(l)},{default:a(()=>[...e[17]||(e[17]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(f,{link:"",type:"danger",icon:"Delete",onClick:w=>P(l)},{default:a(()=>[...e[18]||(e[18]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,C.value]]),k("div",be,[t(Q,{"current-page":u.pageNum,"onUpdate:currentPage":e[2]||(e[2]=l=>u.pageNum=l),"page-size":u.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>u.pageSize=l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])])]),t(X,{title:p.title,modelValue:p.visible,"onUpdate:modelValue":e[12]||(e[12]=l=>p.visible=l),width:"500px","append-to-body":""},{footer:a(()=>[t(f,{onClick:e[11]||(e[11]=l=>p.visible=!1)},{default:a(()=>[...e[21]||(e[21]=[r("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:K},{default:a(()=>[...e[22]||(e[22]=[r("确定",-1)])]),_:1})]),default:a(()=>[t(D,{ref_key:"userFormRef",ref:U,model:o,rules:q,"label-width":"80px"},{default:a(()=>[t(i,{label:"用户账号",prop:"username"},{default:a(()=>[t(g,{modelValue:o.username,"onUpdate:modelValue":e[4]||(e[4]=l=>o.username=l),placeholder:"请输入账号",disabled:!!o.id},null,8,["modelValue","disabled"])]),_:1}),o.id?ae("",!0):(c(),v(i,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[t(g,{modelValue:o.password,"onUpdate:modelValue":e[5]||(e[5]=l=>o.password=l),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),t(i,{label:"用户昵称",prop:"nickname"},{default:a(()=>[t(g,{modelValue:o.nickname,"onUpdate:modelValue":e[6]||(e[6]=l=>o.nickname=l),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),t(i,{label:"关联角色",prop:"roleId"},{default:a(()=>[t(H,{modelValue:o.roleId,"onUpdate:modelValue":e[7]||(e[7]=l=>o.roleId=l),placeholder:"请选择角色",class:"w-full"},{default:a(()=>[(c(!0),I(oe,null,ne(z.value,l=>(c(),v(G,{key:l.id,label:l.roleName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"手机号码",prop:"phone"},{default:a(()=>[t(g,{modelValue:o.phone,"onUpdate:modelValue":e[8]||(e[8]=l=>o.phone=l),maxlength:"11"},null,8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:a(()=>[t(W,{modelValue:o.status,"onUpdate:modelValue":e[9]||(e[9]=l=>o.status=l)},{default:a(()=>[t(E,{value:1},{default:a(()=>[...e[19]||(e[19]=[r("正常",-1)])]),_:1}),t(E,{value:0},{default:a(()=>[...e[20]||(e[20]=[r("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"备注"},{default:a(()=>[t(g,{modelValue:o.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>o.remark=l),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Ve as default};
