import{g as J,h as w,l as U,m as W,r as s,z as X,a as Y,o as r,b as F,e as l,w as t,n as Z,f as d,A as ee,s as m,v,B as le,C as L,D as te,F as oe,G as ne,E as h,H as ae,I as de}from"./index-B9wvQeQm.js";const se={class:"p-6"},ue={class:"bg-white p-4 rounded-lg shadow-sm mb-4"},ie={class:"bg-white p-4 rounded-lg shadow-sm"},re={class:"dialog-footer"},_e=J({name:"Menu",__name:"menu",setup(me){const k=w(!1),x=w([]),I=w([]),C=w(),c=U({menuName:void 0,status:void 0}),p=U({title:"",visible:!1}),o=U({id:void 0,parentId:0,menuName:"",icon:"",type:"M",sort:0,path:"",component:"",perms:"",hidden:0,noCache:0}),P={menuName:[{required:!0,message:"菜单名称不能为空",trigger:"blur"}],sort:[{required:!0,message:"菜单顺序不能为空",trigger:"blur"}],path:[{required:!0,message:"路由地址不能为空",trigger:"blur"}],component:[{validator:(a,e,i)=>{o.type==="C"&&!e?i(new Error("菜单组件路径不能为空")):i()},trigger:"blur"}]},g=async()=>{k.value=!0;try{const a=await L(c);x.value=a.data}finally{k.value=!1}},E=async()=>{const a=await L({}),e={id:0,label:"主类目",children:[]};e.children=a.data.map(i=>B(i)),I.value=[e]},B=a=>({id:a.id,label:a.menu_name,children:a.children?a.children.map(B):void 0}),D=()=>g(),T=async a=>{$(),await E();const e=await te(a.id),{parent_id:i,menu_name:u,no_cache:f,...V}=e.data;console.log("菜单详情",e),Object.keys(o).forEach(_=>{o[_]=void 0}),Object.assign(o,{...V,parentId:i,menuName:u,noCache:f}),p.title="修改菜单",p.visible=!0},$=()=>{Object.assign(o,{id:void 0,parentId:0,menuName:"",icon:"",type:"M",sort:0,path:"",component:"",perms:"",hidden:0,noCache:0}),C.value?.resetFields()},q=a=>{$(),E(),a!=null&&a.id?o.parentId=a.id:o.parentId=0,p.title="添加菜单",p.visible=!0},A=a=>{oe.confirm(`是否确认删除名称为"${a.menu_name}"的数据项?`,"警告",{type:"warning"}).then(async()=>{await ne(a.id),h.success("删除成功"),g()})};W(()=>{g()});const K=async()=>{await C.value.validate(async a=>{a&&(o.id?(await ae(o),h.success("修改成功")):(console.log("form",o),await de(o),h.success("新增成功")),p.visible=!1,g())})};return(a,e)=>{const i=s("el-input"),u=s("el-form-item"),f=s("el-button"),V=s("el-form"),_=s("el-table-column"),R=s("el-icon"),O=s("el-tag"),S=s("el-table"),z=s("el-tree-select"),y=s("el-radio"),N=s("el-radio-group"),b=s("el-col"),G=s("el-input-number"),M=s("el-row"),H=s("el-dialog"),Q=X("loading");return r(),Y("div",se,[F("div",ue,[l(V,{inline:!0,model:c},{default:t(()=>[l(u,{label:"菜单名称"},{default:t(()=>[l(i,{modelValue:c.menuName,"onUpdate:modelValue":e[0]||(e[0]=n=>c.menuName=n),placeholder:"请输入菜单名称",clearable:"",onKeyup:Z(D,["enter"])},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(f,{type:"primary",icon:"Search",onClick:D},{default:t(()=>[...e[14]||(e[14]=[d("搜索",-1)])]),_:1}),l(f,{type:"primary",plain:"",icon:"Plus",onClick:e[1]||(e[1]=n=>q())},{default:t(()=>[...e[15]||(e[15]=[d("新增",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),F("div",ie,[ee((r(),m(S,{data:x.value,"row-key":"id",border:"","tree-props":{children:"children"}},{default:t(()=>[l(_,{prop:"menu_name",label:"菜单名称","show-overflow-tooltip":!0,width:"160"}),l(_,{prop:"icon",label:"图标",align:"center",width:"60"},{default:t(({row:n})=>[n.icon?(r(),m(R,{key:0},{default:t(()=>[(r(),m(le(n.icon)))]),_:2},1024)):v("",!0)]),_:1}),l(_,{prop:"sort",label:"排序",width:"60",align:"center"}),l(_,{prop:"perms",label:"权限标识","show-overflow-tooltip":!0}),l(_,{prop:"component",label:"组件路径","show-overflow-tooltip":!0}),l(_,{prop:"hidden",label:"显示状态",width:"80",align:"center"},{default:t(({row:n})=>[n.hidden===0?(r(),m(O,{key:0,type:"success"},{default:t(()=>[...e[16]||(e[16]=[d("显示",-1)])]),_:1})):(r(),m(O,{key:1,type:"info"},{default:t(()=>[...e[17]||(e[17]=[d("隐藏",-1)])]),_:1}))]),_:1}),l(_,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:t(n=>[l(f,{link:"",type:"primary",icon:"Edit",onClick:j=>T(n.row)},{default:t(()=>[...e[18]||(e[18]=[d("修改",-1)])]),_:1},8,["onClick"]),l(f,{link:"",type:"primary",icon:"Plus",onClick:j=>q(n.row)},{default:t(()=>[...e[19]||(e[19]=[d("新增",-1)])]),_:1},8,["onClick"]),l(f,{link:"",type:"danger",icon:"Delete",onClick:j=>A(n.row)},{default:t(()=>[...e[20]||(e[20]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]])]),l(H,{title:p.title,modelValue:p.visible,"onUpdate:modelValue":e[13]||(e[13]=n=>p.visible=n),width:"680px","append-to-body":""},{footer:t(()=>[F("div",re,[l(f,{onClick:e[12]||(e[12]=n=>p.visible=!1)},{default:t(()=>[...e[28]||(e[28]=[d("取 消",-1)])]),_:1}),l(f,{type:"primary",onClick:K},{default:t(()=>[...e[29]||(e[29]=[d("确 定",-1)])]),_:1})])]),default:t(()=>[l(V,{ref_key:"menuFormRef",ref:C,model:o,rules:P,"label-width":"100px"},{default:t(()=>[l(u,{label:"上级菜单"},{default:t(()=>[l(z,{modelValue:o.parentId,"onUpdate:modelValue":e[2]||(e[2]=n=>o.parentId=n),data:I.value,props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"选择上级菜单","check-strictly":"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(u,{label:"菜单类型",prop:"type"},{default:t(()=>[l(N,{modelValue:o.type,"onUpdate:modelValue":e[3]||(e[3]=n=>o.type=n)},{default:t(()=>[l(y,{value:"M"},{default:t(()=>[...e[21]||(e[21]=[d("目录",-1)])]),_:1}),l(y,{value:"C"},{default:t(()=>[...e[22]||(e[22]=[d("菜单",-1)])]),_:1}),l(y,{value:"F"},{default:t(()=>[...e[23]||(e[23]=[d("按钮",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.type!=="F"?(r(),m(u,{key:0,label:"菜单图标"},{default:t(()=>[l(i,{modelValue:o.icon,"onUpdate:modelValue":e[4]||(e[4]=n=>o.icon=n),placeholder:"请输入图标名称 (如 user)"},null,8,["modelValue"])]),_:1})):v("",!0),l(M,null,{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"菜单名称",prop:"menuName"},{default:t(()=>[l(i,{modelValue:o.menuName,"onUpdate:modelValue":e[5]||(e[5]=n=>o.menuName=n),placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(b,{span:12},{default:t(()=>[l(u,{label:"显示排序",prop:"sort"},{default:t(()=>[l(G,{modelValue:o.sort,"onUpdate:modelValue":e[6]||(e[6]=n=>o.sort=n),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(M,null,{default:t(()=>[o.type!=="F"?(r(),m(b,{key:0,span:12},{default:t(()=>[l(u,{label:"路由地址",prop:"path"},{default:t(()=>[l(i,{modelValue:o.path,"onUpdate:modelValue":e[7]||(e[7]=n=>o.path=n),placeholder:"请输入路由地址"},null,8,["modelValue"])]),_:1})]),_:1})):v("",!0),o.type==="C"?(r(),m(b,{key:1,span:12},{default:t(()=>[l(u,{label:"组件路径",prop:"component"},{default:t(()=>[l(i,{modelValue:o.component,"onUpdate:modelValue":e[8]||(e[8]=n=>o.component=n),placeholder:"views下的路径 (如 system/user/index)"},null,8,["modelValue"])]),_:1})]),_:1})):v("",!0)]),_:1}),o.type!=="M"?(r(),m(u,{key:1,label:"权限字符"},{default:t(()=>[l(i,{modelValue:o.perms,"onUpdate:modelValue":e[9]||(e[9]=n=>o.perms=n),placeholder:"controller中定义的权限字符，如：system:user:list"},null,8,["modelValue"])]),_:1})):v("",!0),o.type!=="F"?(r(),m(M,{key:2},{default:t(()=>[l(b,{span:12},{default:t(()=>[l(u,{label:"显示状态"},{default:t(()=>[l(N,{modelValue:o.hidden,"onUpdate:modelValue":e[10]||(e[10]=n=>o.hidden=n)},{default:t(()=>[l(y,{value:0},{default:t(()=>[...e[24]||(e[24]=[d("显示",-1)])]),_:1}),l(y,{value:1},{default:t(()=>[...e[25]||(e[25]=[d("隐藏",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o.type==="C"?(r(),m(b,{key:0,span:12},{default:t(()=>[l(u,{label:"是否缓存"},{default:t(()=>[l(N,{modelValue:o.noCache,"onUpdate:modelValue":e[11]||(e[11]=n=>o.noCache=n)},{default:t(()=>[l(y,{value:0},{default:t(()=>[...e[26]||(e[26]=[d("缓存",-1)])]),_:1}),l(y,{value:1},{default:t(()=>[...e[27]||(e[27]=[d("不缓存",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):v("",!0)]),_:1})):v("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{_e as default};
